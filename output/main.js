!function(){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var n={exports:{}};(function(e,n){var t={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function o(){return"jsonp_"+Date.now()+"_"+Math.ceil(1e5*Math.random())}function s(e){try{delete window[e]}catch(n){window[e]=void 0}}function r(e){var n=document.getElementById(e);n&&document.getElementsByTagName("head")[0].removeChild(n)}function i(e){var n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=e,a=n.timeout||t.timeout,c=n.jsonpCallback||t.jsonpCallback,l=void 0;return new Promise((function(t,u){var d=n.jsonpCallbackFunction||o(),g=c+"_"+d;window[d]=function(e){t({ok:!0,json:function(){return Promise.resolve(e)}}),l&&clearTimeout(l),r(g),s(d)},i+=-1===i.indexOf("?")?"?":"&";var h=document.createElement("script");h.setAttribute("src",""+i+c+"="+d),n.charset&&h.setAttribute("charset",n.charset),n.nonce&&h.setAttribute("nonce",n.nonce),n.referrerPolicy&&h.setAttribute("referrerPolicy",n.referrerPolicy),n.crossorigin&&h.setAttribute("crossorigin","true"),h.id=g,document.getElementsByTagName("head")[0].appendChild(h),l=setTimeout((function(){u(new Error("JSONP request to "+e+" timed out")),s(d),r(g),window[d]=function(){s(d)}}),a),h.onerror=function(){u(new Error("JSONP request to "+e+" failed")),s(d),r(g),l&&clearTimeout(l)}}))}n.exports=i})(0,n);var t=e(n.exports);const o=JSON.parse('{\r\n    "baidu": {\r\n      "name": "百度",\r\n      "url": "https://www.baidu.com/s?wd=",\r\n      "translation": "https://fanyi.baidu.com/#zh/en/",\r\n      "icon": "baidu"\r\n    },\r\n    "bing": {\r\n      "name": "必应",\r\n      "url": "https://www.bing.com/search?q=",\r\n      "translation": "https://www.bing.com/translator?text=",\r\n      "icon": "bing"\r\n    },\r\n    "google": {\r\n      "name": "Google",\r\n      "url": "https://www.google.com/search?q=",\r\n      "translation": "https://translate.google.com/?text=",\r\n      "icon": "google"\r\n    }\r\n  }'),s=(e,n)=>{e&&o[n.engine]&&(n.blank?window.open(o[n.engine].url+encodeURIComponent(e),"_blank"):window.location.href=o[n.engine].url+encodeURIComponent(e))};function r(e,n){const t=window.localStorage.getItem(e)||n,o=[];return{set(n){window.localStorage.setItem(e,n),o.forEach((e=>e(n,this.value))),this.value=n},subscribe(e){o.push(e)},unsubscribe(e){const n=o.indexOf(e);n>=0&&o.splice(n,1)},value:t}}const i=e=>document.querySelector(e),a=r("search-engine","google"),c=r("bg-img",""),l=["google","bing","baidu"];function u(e){o[e],i(".search-engine-select").innerHTML=`\n        <i class="iconfont icon-${e} search-engine-icon"></i>\n    `}function d(e){e&&(i(".cover").style.backgroundImage=`url(${e})`)}i(".search-form").addEventListener("submit",(e=>{s(e.target[0].value,{engine:a.value}),e.preventDefault()})),i(".search-input").addEventListener("input",(async e=>{console.log("input事件触发");try{const n=await(async e=>{try{const n=encodeURIComponent(e),o=await t(`https://suggestion.baidu.com/su?wd=${n}`,{jsonpCallback:"cb"});return(await o.json()).s}catch(e){return console.error("处理搜索建议发生错误：",e),null}})(e.target.value);if(!n?.length)return void i(".search").classList.remove("has-suggestion");i(".search").classList.add("has-suggestion"),i(".search-suggestion").innerHTML="",i(".search-suggestion").append(...n.map((e=>{const n=document.createElement("li");return n.classList.add("search-suggestion-item"),n.textContent=e,n})))}catch(e){console.error("更新搜索建议失败",e),i(".search").classList.remove("has-suggestion")}})),i(".search-input").addEventListener("focus",(()=>{i(".search").classList.add("show-suggestion")})),document.addEventListener("click",(e=>{const n=i(".search");!n!==e.target||n.contains(e.target)||n.classList.remove("show-suggestion")})),i(".search-suggestion").addEventListener("click",(e=>{e.target.classList.contains("search-suggestion-item")&&s(e.target.textContent,{engine:a.value})})),i(".search-engine-select").addEventListener("click",(e=>{const n=(l.indexOf(a.value)+1)%l.length;a.set(l[n])})),u(a.value),a.subscribe(u),i("#bg-select").addEventListener("change",(e=>{const n=e.target.files[0];if(n){const e=new FileReader;e.onload=function(e){c.set(e.target.result)},e.readAsDataURL(n)}})),i(".cover").addEventListener("dblclick",(()=>{i("#bg-select").click()})),d(c.value),c.subscribe(d)}();
